<!--BitAdmin2.0框架文件-->
<!DOCTYPE html>
<html>
<head>
    <title>BitAdminCore-首页</title>
    <meta name="description" content="BitAdminCore, Version 1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <!--基础引用-->
    <link href="../../lib/twitter-bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../../lib/font-awesome/css/all.min.css" rel="stylesheet" />
    <link href="../../lib/admin-lte/css/AdminLTE.min.css" rel="stylesheet" />
    <link href="../../lib/admin-lte/css/skins/_all-skins.min.css" rel="stylesheet" />

    <link rel="stylesheet" href="../../css/framework/BitAdmin.css" />

    <link href="../../css/lib/spop.min.css" rel="stylesheet" />
    <style>
        .main-header .sidebar-toggle {
            padding: 0px;
        }

            .main-header .sidebar-toggle:before {
                content: "";
            }

        .content-wrapper .content {
            padding: 2px 0px 0px 0px;
        }

        .nav-tabs > li.active > a, .nav-tabs > li.active > a:focus, .nav-tabs > li.active > a:hover {
            border-bottom-color: #ddd;
        }

        #page-tabs {
            position: relative;
            z-index: 26;
            white-space: nowrap;
            width: 100%;
            overflow: hidden;
            margin: 0px 20px;
        }

            #page-tabs li {
                display: inline-block;
            }
            
        .nav-tabs > li {
            float: none;
        }

        #menu {
            z-index: 999999;
            width: 125px;
            overflow: hidden;
            box-shadow: none;
            border: 1px solid #098cb7;
            position: absolute;
            background-color: #098cb7;
            border-radius: 5px;
        }

        .menu {
            border: 0;
            width: 130px;
            margin: 0;
            background-color: transparent;
            line-height: 30px;
            padding: 0 10px;
            text-align: left;
            color: #ffffff;
        }

            .menu:hover {
                background-color: rgba(12,23,45,0.9);
                color: #ffffff;
            }
    </style>
</head>
<body class="hold-transition skin-blue fixed sidebar-mini">
    <div class="wrapper" style="margin-top:0px;">
        <header class="main-header">
            <a href="/pages/home/index.html" class="logo">
                <span class="logo-lg"><b>BitAdminCore</b></span>
                <span class="logo-mini"><b>Core</b></span>
            </a>
            <nav class="navbar fixed-top">
                <a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button">
                    <i class="fas fa-align-justify"></i>
                    <span class="sr-only">打开/关闭菜单</span>
                    <span class="icon-bar"></span>
                </a>
                <div class="navbar-custom-menu">
                    <ul class="nav navbar-nav">
                        <li class="dropdown user user-menu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <img src="../../images/home/user.jpg" class="user-image">
                                <span class="hidden-xs userName"></span>
                            </a>
                            <ul class="dropdown-menu">
                                <li class="user-header" style="height:145px;text-align:left;">
                                    <img src="../../images/home/user.jpg" class="img-circle userImage">
                                    <p><span class="departmentName"></span></p>
                                    <div style="float:right;margin-top:-130px;width:160px;">
                                        <p style="margin-bottom:0.5rem;color:white;"><span class="userName"></span></p>
                                        <p style="margin-bottom:0.5rem;color:white;"><span class="mobile"></span></p>
                                        <p style="margin-bottom:0.5rem;color:white;"><span class="email"></span></p>
                                    </div>
                                </li>
                                <li class="user-footer" style="padding:1px 0px 0px 0px;">
                                    <div class="btn-group">
                                        <button type="button" style="width:140px;" class="btn btn-primary" data-toggle="modal" data-target="#PasswordModal">修改密码</button>
                                        <button type="button" style="width:140px;" class="btn btn-primary signout">退出登录</button>
                                    </div>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>
        <!-- =============================================== -->
        <aside class="main-sidebar">
            <section class="sidebar" style="overflow: auto;">
                <ul class="sidebar-menu" data-widget="tree"></ul>
            </section>
        </aside>
        <!-- =============================================== -->
        <div class="content-wrapper" style="background-color:white;padding-top:50px;" mode="tab">
            <section class="content">
                <div class="tab-title" style="position: relative; border-bottom: 1px solid #ddd; padding:0px 5px;">
                    <div>
                        <a href="javascript:void(0);"><i id="Up" class="fas fa-angle-left" style="float:left;margin-top:7px;"></i></a>
                        <a href="javascript:void(0);"><i id="Down" class="fas fa-angle-right" style="float:right;margin-top:7px;"></i></a>
                    </div>
                    <ul class="nav nav-tabs" id="page-tabs" style="border-bottom: none; position: relative; white-space: nowrap; overflow: hidden;flex-wrap:nowrap;">
                        <li class="nav-item"><a class="nav-link active" href="#home" data-toggle="tab" aria-expanded="false">首页</a></li>
                        <li class="nav-item"><a class="nav-link" href="#notice" data-toggle="tab" aria-expanded="false">示例</a></li>
                    </ul>
                </div>
                <div class="tab-content" id="tab-content">
                    <div role="tabpanel" class="tab-pane active" id="home">
                        <iframe id="iframe_page_home" style="width: 100%;" src="summary.html" frameborder="0" border="0" marginwidth="0" marginheight="0" scrolling="auto" allowtransparency="true"></iframe>
                    </div>
                    <div role="tabpanel" class="tab-pane" id="notice">
                        <iframe id="iframe_page_notice" style="width: 100%;" src="readme.html" frameborder="0" border="0" marginwidth="0" marginheight="0" scrolling="auto" allowtransparency="true"></iframe>
                    </div>
                </div>

            </section>
        </div>
        <footer class="main-footer" style="padding: 5px;">
            <script>var _hmt = _hmt || []; (function () { var hm = document.createElement("script"); hm.src = "https://hm.baidu.com/hm.js?67d9c965e616fb773b85f279d372b0c4"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s); })();</script>
            <strong>Copyright &copy; 2017-2019 <a href="javascript:void();">bitdao</a>.</strong> All rights reserved.
            <div style="float:right;">
                <b>Version</b> 1.0.0
            </div>
        </footer>
        <!-- 修改密码 -->
        <div class="modal fade" id="PasswordModal">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4>修改密码</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    </div>
                    <div class="modal-body" style="padding:0.5rem;">
                        <div class="input-group" style="margin-bottom:0.5rem;">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                            </div>
                            <input type="password" id="OldPassword" class="form-control" placeholder="旧密码">
                        </div>
                        <div class="input-group" style="margin-bottom:0.5rem;">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                            </div>
                            <input type="password" id="NewPasswordOne" class="form-control" placeholder="新密码">
                        </div>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                            </div>
                            <input type="password" id="NewPasswordTow" class="form-control" placeholder="新密码确认">
                        </div>
                        <div class="form-group"style="margin-bottom:0px;">
                            <span id="spanmsg" style="color:red;"></span>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fas fa-times"></i> 关闭</button>
                        <button type="button" class="btn btn-primary" id="savePassword">修改密码</button>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal -->
        </div>
        <div id="menu" style="display:none;">
            <button type="button" class="btn btn-default menu refresh">刷新</button>
            <button type="button" class="btn btn-default menu closeOne">关闭</button>
            <button type="button" class="btn btn-default menu closeOther">关闭其他</button>
            <button type="button" class="btn btn-default menu closeAll">关闭全部</button>
        </div>
    </div>
    <!-- ./wrapper -->
    <!--基础引用-->
    <script src="../../lib/jquery/jquery.min.js"></script>
    <script src="../../lib/twitter-bootstrap/js/bootstrap.min.js"></script>
    <script src="../../lib/admin-lte/js/adminlte.min.js"></script>
    <!-- 组件引用 -->
    <script type="text/javascript" src="../../js/framework/BitAdmin.js"></script>
    <script type="text/javascript" src="../../js/framework/BitAdmin-frame.js"></script>

    <script src="../../js/lib/spop.min.js"></script>
    <script type="text/javascript">
        BitAdmin.IsLogin(function () {
            $(".user").GetUserInfo();
            $(".sidebar-menu").GetMenus();
        }, "page");

        $(window).bind("load", function () {
            BitAdmin.setTabsWidth();
            BitAdmin.setMentHeight();
            $("[mode=" + BitAdmin.mode + "] iframe").height(BitAdmin.getIframeHeight());
        });

        $(function () {
            $(window).resize(function () {
                BitAdmin.setTabsWidth();
                BitAdmin.setMentHeight();
                $("[mode=" + BitAdmin.mode + "] iframe").height(BitAdmin.getIframeHeight());
            });

            //右键菜单关闭
            window.onclick = function (e) {
                $('#menu').hide();
            }
            //刷新
            $("#menu > .refresh").click(function () {
                var id = $("#menu").attr("data-id");
                BitAdmin.refreshTab('iframe_' + id);
            });
            //关闭
            $("#menu > .closeOne").click(function () {
                var id = $("#menu").attr("data-id");
                var li_id = "tab_li_" + id;
                //如果关闭tab是当前选中的tab，则激活前一个tab
                if ($("li a.active").parent().attr('id') == li_id) {
                    $("li a.active").parent().prev().find("a").click();
                }
                $("#" + li_id).remove();
                $("#tab_content_" + id).remove();
            });

            //关闭全部
            $("#menu > .closeAll").click(function () {
                $(".tab-title ul li").each(function (i, d) {
                    var id = d.id.replace("tab_li_", "");
                    if (d.id != "") {
                        $("#" + d.id).remove();
                        $("#tab_content_" + id).remove();
                    }
                });
                $(".tab-title ul li").find("a").click();
            });

            //关闭其她
            $("#menu > .closeOther").click(function () {
                var id = $("#menu").attr("data-id");
                $(".tab-title ul li").each(function (i, d) {
                    if (d.id != "") {
                        var ids = d.id.replace("tab_li_", "");
                        if (id != ids) {
                            var ids = d.id.replace("tab_li_", "");
                            $("#" + d.id).remove();
                            $("#tab_content_" + ids).remove();
                        }
                    }
                });
                $("#tab_li_" + id).find("a").click();
            });

            $('#Down').bind('click', function () {
                var num = $('#page-tabs').scrollLeft();
                $('#page-tabs').scrollLeft(num + 100);
            });

            $('#Up').bind('click', function () {
                var num = $('#page-tabs').scrollLeft();
                if (num < 0) {
                    return;
                }
                $('#page-tabs').scrollLeft(num - 100);
            });

            $(".signout").click(function () {
                $.get("../../account/signOut", function (result) {
                    if (result.code == 0) BitAdmin.RedirectToLoginPage();
                });
                return false;
            });

            $('#PasswordModal').on('show.bs.modal', function () {
                $("#OldPassword").val("");
                $("#NewPasswordOne").val("");
                $("#NewPasswordTow").val("");
            })
            $("#savePassword").click(function () {
                $("#spanmsg").text("");
                var oldpassword = $("#OldPassword").val();
                var newpasswordone = $("#NewPasswordOne").val();
                var newpasswordtow = $("#NewPasswordTow").val();
                if (oldpassword == "") {
                    $("#spanmsg").text("请输入旧密码");
                    return;
                }
                if (newpasswordone == "" || newpasswordtow == "") {
                    $("#spanmsg").text("请输入新密码");
                    return;
                }
                if (newpasswordone != newpasswordtow) {
                    $("#spanmsg").text("两次新密码不相同");
                    return;
                }
                //密码复杂度
                if (newpasswordone.length < 6) {
                    $("#spanmsg").text("密码长度大于6位");
                    return;
                }

                $.showLoading();
                $.ajax({
                    url: "../../account/UpdatePassword",
                    data: { OldPwd: oldpassword, NewPwd: newpasswordone },
                    datatype: "json",
                    type: "post",
                    success: function (result) {
                        if (result.code == 0) {
                            alert(result.msg);
                            $(".PasswordModal").modal("hide");
                        } else {
                            $("#spanmsg").text(result.msg);
                        }
                        $.hideLoading();
                    },
                    error: function (a, b, c) {
                        alert(a.responseText);
                        $.hideLoading();
                    }
                });
            });
            BitNoticeService = BitNotice();
        });

        var BitNotice = function () {
            var protocol = document.location.protocol == "https:" ? "wss" : "ws";
            var uri = protocol + "://" + window.location.host + "/websocket/notice";
            var socket = new WebSocket(uri);
            socket.onopen = function (e) { write("opened " + uri); send("open"); };
            socket.onclose = function (e) { write("closed"); };
            socket.onmessage = function (e) { receive(e.data); };
            socket.onerror = function (e) { write("error: " + e.data); };
            var send = function (message) {
                var msgObj = {
                    Sender: "open",
                    Receiver: "server",
                    MessageType: "notice",
                    Content: message
                };
                write("sending: " + JSON.stringify(msgObj));
                socket.send(JSON.stringify(msgObj));
            };
            var receive = function (msg) {
                console.log(msg);
                var msgObj = JSON.parse(msg);
                switch (msgObj.MessageType) {
                    case "notice"://通知消息
                        spop({
                            template: msgObj.Content,
                            position: 'bottom-right'
                        });
                        break;
                    case "chat"://聊天消息
                        spop({
                            template: msgObj.Content,
                            position: 'bottom-right'
                        });
                        break;
                }
            };
            var write = function (msg) {
                //console.log(msg);
            };
            var result = {};
            result.sendNotice = function (message) {
                var msgObj = {
                    Sender: "",
                    Receiver: "server",
                    MessageType: "notice",
                    Content: message
                };
                write("sending: " + JSON.stringify(msgObj));
                socket.send(JSON.stringify(msgObj));
            };
            result.sendChat = function (receiver, message) {
                var msgObj = {
                    Sender: "",
                    Receiver: receiver,
                    MessageType: "chat",
                    Content: message
                };
                write("sending: " + JSON.stringify(msgObj));
                socket.send(JSON.stringify(msgObj));
            };
            return result;
        }


    </script>
</body>
</html>
